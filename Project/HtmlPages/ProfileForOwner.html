<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <h3>Имя пользователя: <label id="usernameLabel"></label></h3>
    <img id="photoImg" alt="Аватар" style="vertical-align: middle; width: 150px; height: 150px; border-radius: 50%;">
    <!--Файл для нового фото-->
    <input type="file" id="photoInput" accept="image/*" hidden>
    <br>
    Описание: <label id="descriptionLabel"></label>
    <!--Новое описание-->
    <input id="descriptionInput" type="text" hidden>
    <br>
    <button id="changeinformationButton">Изменить описание или фото</button>
    <button id="saveButton" hidden>Сохранить изменения</button>
    <h3>Почта: <label id="emailLabel"></label></h3>
    <h3>Дата создания: <label id="creationdateLabel"></label></h3>
    <button id="exitaccountButton">Выйти из аккаунта</button>
    <button id="addportfolioButton">Добавить портфолио</button>
    <br>
    <!--Список портфолио со ссылкой на само портфолио-->
    <div id="portfoliosDiv">
        
    </div>

    <script>
        const usernameLabel = document.getElementById("usernameLabel");
        const photoImg = document.getElementById("photoImg");
        const photoInput = document.getElementById("photoInput");
        const descriptionLabel = document.getElementById("descriptionLabel");
        const descriptionInput = document.getElementById("descriptionInput");
        const changeinformationButton = document.getElementById("changeinformationButton");
        const saveButton = document.getElementById("saveButton");
        const emailLabel = document.getElementById("emailLabel");
        const creationdateLabel = document.getElementById("creationdateLabel");
        const exitaccountButton = document.getElementById("exitaccountButton");
        const addportfolioButton = document.getElementById("addportfolioButton");
        const portfoliosDiv = document.getElementById("portfoliosDiv");
        const username = location.pathname;

        changeinformationButton.onclick = (() => {
            changeinformationButton.hidden = true;
            photoImg.hidden = true;
            descriptionLabel.hidden = true;
            descriptionInput.value = descriptionLabel.innerHTML;
            photoInput.hidden = false;
            descriptionInput.hidden = false;
            saveButton.hidden = false;

            saveButton.onclick = (async () => {
                const reader = new FileReader();
                const file = photoInput.files[0];
                if (file != null) {
                    reader.readAsDataURL(file);
                    reader.onload = (async () => {
                        await fetch(username + "/changeinformation", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },

                            body: JSON.stringify({
                                avatar: reader.result,
                                description: descriptionInput.value
                            })
                        });
                    })
                }

                else {
                    await fetch(username + "/changeinformation", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },

                        body: JSON.stringify({
                            description: descriptionInput.value
                        })
                    }
                    )
                }

                location.reload();
            });
        });

        exitaccountButton.onclick = (async () => {
            await fetch("unregister", {
                method: "GET"
            });

            window.location.href = "/";
        });

        window.onload = (async () => {
            const prom = await fetch(username + "/getinformation", {
                method:"GET"
            });

            const data = await prom.json();
            usernameLabel.innerHTML = data.username;
            descriptionLabel.innerHTML = data.description;
            emailLabel.innerHTML = data.email;
            creationdateLabel.innerHTML = data.date;
            if (data.avatar != null)
                photoImg.setAttribute("src", "data:image/jpeg;base64," + data.avatar);
            for (let portfolio of data.portfolios) {
                const block = document.createElement("div");
                const user = document.createElement("a");
                user.style = "font-size: 25px;";
                user.innerHTML = portfolio.portfolioName;
                user.setAttribute("href", username + "/" + portfolio.portfolioName)
                block.appendChild(user);
                const br = document.createElement("br");
                block.appendChild(br);
                const description = document.createElement("label");
                description.innerHTML = portfolio.description;
                block.appendChild(description);
                const creationDate = document.createElement("h3");
                creationDate.innerHTML = portfolio.creationDate;
                block.appendChild(creationDate);
                block.style = "border: solid;";
                portfoliosDiv.appendChild(block);
            }
        });

        addportfolioButton.onclick = (() => {
            window.location = username + "/createportfolio";
        });
    </script>
</body>
</html>