<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    Название: <input id="nameInput">
    Описание: <input id="descriptionInput">
    Файл: <input type="file" id="fileInput">
    <button id="addButton">Добавить</button>
    <label id="statusLabel"></label>

    <script>
        const nameInput = document.getElementById("nameInput");
        const descriptionInput = document.getElementById("descriptionInput");
        const fileInput = document.getElementById("fileInput");
        const addButton = document.getElementById("addButton");
        const statusLabel = document.getElementById("statusLabel");
        const username = location.pathname;
        const english = /^[A-Za-z0-9]*$/;

        function hasWhiteSpace(s) {
            return s.indexOf(' ') >= 0;
        }

        addButton.onclick = (async () => {
            if (hasWhiteSpace(nameInput.value)) {
                statusLabel.innerHTML = "В названии не может быть пробелов";
                setTimeout(() => statusLabel.innerHTML = "", 3000);
            }

            else if (!english.test(nameInput.value)) {
                statusLabel.innerHTML = "В названии только английские символы";
                setTimeout(() => statusLabel.innerHTML = "", 3000);
            }

            else if (fileInput.files[0] != null) {
                const nameofportfolio = nameInput.value.toLowerCase();
                const reader = new FileReader();
                reader.readAsDataURL(fileInput.files[0]);
                reader.onload = (async () => {
                    await fetch(username + "/addportfolio", {
                        method: "POST",
                        body: JSON.stringify({
                            nameofportfolio,
                            description: descriptionInput.value,
                            workfile: reader.result
                        }),
                        headers: {
                            "Content-Type": "application/json"
                        }
                    }).then((response) => {
                        if (response.ok)
                            statusLabel.innerHTML = "Успешно!";
                        else if (response.status == 400)
                            statusLabel.innerHTML = "Портфолио с таким названием уже у Вас есть"
                    })
                });
            }

            else {
                const nameofportfolio = nameInput.value.toLowerCase();
                await fetch(username + "/addportfolio", {
                    method: "POST",
                    body: JSON.stringify({
                        nameofportfolio,
                        description: descriptionInput.value
                    }),
                    headers: {
                        "Content-Type": "application/json"
                    }
                }).then((response) => {
                    if (response.ok)
                        statusLabel.innerHTML = "Успешно!";
                    else if (response.status == 400)
                        statusLabel.innerHTML="Портфолио с таким названием уже у Вас есть"
                })
            }
        });
    </script>
</body>
</html>